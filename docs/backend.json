{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile within the ThrottleLife application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "userName": {
          "type": "string",
          "description": "User's username."
        },
        "displayName": {
          "type": "string",
          "description": "User's display name, which may be different from the username."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "bio": {
          "type": "string",
          "description": "A short biography or description of the user."
        },
        "socialLinks": {
          "type": "array",
          "description": "An array of URLs to the user's social media profiles.",
          "items": {
            "type": "string"
          }
        },
        "profilePictureUrl": {
          "type": "string",
          "description": "URL to the user's profile picture."
        }
      },
      "required": [
        "id",
        "userName",
        "displayName",
        "email"
      ]
    },
    "NewsArticle": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "NewsArticle",
      "type": "object",
      "description": "Represents a news article related to motorcycles.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the news article."
        },
        "sourceName": {
          "type": "string",
          "description": "The source of the news article (e.g., 'Motorcycle News Daily')."
        },
        "title": {
          "type": "string",
          "description": "The title of the news article."
        },
        "url": {
          "type": "string",
          "description": "URL to the full news article.",
          "format": "uri"
        },
        "imageUrl": {
          "type": "string",
          "description": "URL to an image associated with the news article."
        },
        "publishedDate": {
          "type": "string",
          "description": "Date and time when the article was published.",
          "format": "date-time"
        },
        "contentSnippet": {
          "type": "string",
          "description": "A brief summary or excerpt of the news article content."
        }
      },
      "required": [
        "id",
        "sourceName",
        "title",
        "url",
        "publishedDate"
      ]
    },
    "Photo": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Photo",
      "type": "object",
      "description": "Represents a motorcycle-related photo uploaded by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the photo."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Photo)"
        },
        "uploadDate": {
          "type": "string",
          "description": "Date and time when the photo was uploaded.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A user-provided description of the photo."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL to the full-size photo."
        },
        "thumbnailUrl": {
          "type": "string",
          "description": "URL to a thumbnail version of the photo."
        }
      },
      "required": [
        "id",
        "userId",
        "uploadDate",
        "imageUrl",
        "thumbnailUrl"
      ]
    },
    "TimeSlotRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TimeSlotRequest",
      "type": "object",
      "description": "Represents a request from one user to another for a time slot.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the time slot request."
        },
        "requesterId": {
          "type": "string",
          "description": "Reference to UserProfile of the user making the request. (Relationship: UserProfile 1:N TimeSlotRequest as Requester)"
        },
        "requesteeId": {
          "type": "string",
          "description": "Reference to UserProfile of the user receiving the request. (Relationship: UserProfile 1:N TimeSlotRequest as Requestee)"
        },
        "startTime": {
          "type": "string",
          "description": "The start time of the requested time slot.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "The end time of the requested time slot.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the request (e.g., 'Ride to the coast')."
        },
        "status": {
          "type": "string",
          "description": "The status of the request (e.g., 'Pending', 'Accepted', 'Rejected')."
        }
      },
      "required": [
        "id",
        "requesterId",
        "requesteeId",
        "startTime",
        "endTime",
        "status"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. This collection uses path-based ownership to secure user data. Includes standard profile information like userName, displayName, email, bio, and socialLinks.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, corresponding to the Firebase Authentication UID."
            }
          ]
        }
      },
      {
        "path": "/news_articles/{newsArticleId}",
        "definition": {
          "entityName": "NewsArticle",
          "schema": {
            "$ref": "#/backend/entities/NewsArticle"
          },
          "description": "Stores global news articles related to motorcycles.  Accessible to all users, supporting the motorcycle news feed feature.",
          "params": [
            {
              "name": "newsArticleId",
              "description": "The unique identifier for the news article."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/photos/{photoId}",
        "definition": {
          "entityName": "Photo",
          "schema": {
            "$ref": "#/backend/entities/Photo"
          },
          "description": "Stores photos uploaded by users. Uses path-based ownership to ensure that only the user can access their own photos. Denormalized userId field provides redundant storage of the user id.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who owns the photo."
            },
            {
              "name": "photoId",
              "description": "The unique identifier for the photo."
            }
          ]
        }
      },
      {
        "path": "/time_slot_requests/{timeSlotRequestId}",
        "definition": {
          "entityName": "TimeSlotRequest",
          "schema": {
            "$ref": "#/backend/entities/TimeSlotRequest"
          },
          "description": "Stores time slot requests between users. The document will contain requesterId and requesteeId.  ",
          "params": [
            {
              "name": "timeSlotRequestId",
              "description": "The unique identifier for the time slot request."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the ThrottleLife application's core features, focusing on motorcycle news, user profiles, photo galleries, calendar integration, and time slot requests. The structure prioritizes security, scalability, and debuggability, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters).\n\n**Authorization Independence:** To avoid hierarchical authorization dependencies and enable atomic operations, the design denormalizes authorization context where necessary. For instance, access control information for time slot requests could be denormalized within each request document to avoid relying on `get()` calls to parent documents. This allows security rules to be self-contained and efficient.\n\n**Structural Segregation:** The structure segregates data with different access requirements into distinct collections. User profiles are stored separately from news articles and photos. Private user data (photos) is stored under the user's document.\n\n**Access Modeling:** Path-based ownership is used for user-owned data like photos, which are stored under the `/users/{userId}/photos/{photoId}` path. Time slot requests are modeled to enable requests between users. News articles are stored globally for all users to access.\n\n**QAPs (Rules are not Filters):** The structure enables secure `list` operations by segregating data based on access requirements. Global news articles can be listed without complex filtering rules. User-specific photos can be listed securely under the user's profile.\n\n**Invariants:** The structure supports the integrity of ownership, timestamps, and denormalized data through explicit field definitions and security rules that enforce data consistency.\n"
  }
}